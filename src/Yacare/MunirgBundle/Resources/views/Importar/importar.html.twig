{% extends 'TapirTemplateBundle::layout.html.twig' %}

{% block pagina_titulo %}Importar {{ importando }}{% endblock %}

{% block pagina_contenido %}
    {% if cantidad == 0 %}
    	<p>Cuando esté listo para iniciar la importación, haga clic en el botón iniciar.</p>
    	<a data-toggle="ajax-link" href="{{ path(baseroute ~ '_importarpartidas', arrastre|merge({ 'iniciar': 1 })) }}" class="btn btn-success"><i class="fa fa-play"></i> Iniciar</a>
    	<script>
    		window.YacareImportarDetener = false;
    	</script>
    {% else %}
    	<p>Se están importando los registros...</p>
    	{% if resultado.RegistrosTotal %}
    	<div class="progress">
          <div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar" 
          		aria-valuenow="{{ hasta }}" aria-valuemin="0" aria-valuemax="{{ resultado.RegistrosTotal }}"
          		style="width: {{ ((hasta / resultado.RegistrosTotal) * 100)|round }}%">
          </div>
        </div>
        {% endif %}
    	<p>Se procesaron {{ hasta }} registros,
    		que representan un {{ ((hasta / resultado.RegistrosTotal) * 100)|round }}%
    		del total de {{ resultado.RegistrosTotal }}.
    		En la última iteración se actualizaron 
    		{{ resultado.RegistrosActualizados }} y se importaron
    		{{ resultado.RegistrosNuevos }} nuevos.</p>
{#    
    	<pre>{% for renglon in resultado.Mensajes %}
{{ entry }}
{% endfor %}</pre> #}
    
    	{% if resultado.HayMasRegistros %}
    	<script>
    		if(window.YacareImportarDetener === true) {
        		window.location = '{{ path(baseroute ~ '_importarpartidas', arrastre|merge({ 'iniciar': 0 })) }}';
        	} else {
    			tapirNavegarA("{{ path(baseroute ~ '_importarpartidas', arrastre|merge({ 'iniciar': 1, 'desde': siguientedesde }))|raw }}");
        	}
    	</script>
    	{% endif %}
    
    {% endif %}
{% endblock %}

{% block pagina_acciones2 %}
{% if cantidad != 0 %}
    <a data-toggle="ajax-link" onclick="window.YacareImportarDetener=true; return false;" href="{{ path(baseroute ~ '_importarpartidas', arrastre|merge({ 'iniciar': 0 })) }}" class="btn btn-danger"><i class="fa fa-stop"></i> Detener</a>
{% endif %}
{% endblock %}